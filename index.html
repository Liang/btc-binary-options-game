<!DOCTYPE html>
<html>
<head>
    <title>BTC Binary - Projector</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
    <div id="winner-screen">
        <h1 style="color: var(--primary-gold); font-size: 4rem;">CHAMPION FOUND!</h1>
        <div id="winner-name" style="font-size: 8rem; color: white;">TABLE X</div>
    </div>
    <div class="header">
        <div class="stat-box"><div>JACKPOT</div><div id="jackpot" class="stat-value">$0</div></div>
        <div style="text-align: center;"><div id="status-msg">READY</div><div id="timer" class="stat-value">00</div></div>
        <div class="stat-box"><div>BTC PRICE</div><div id="btc-price" class="stat-value">------</div></div>
    </div>
    <div class="chart-container" id="chart-section">
        <div id="tradingview_btc" style="height: 100%;"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
        <script type="text/javascript">
            new TradingView.widget({"autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "1", "theme": "dark", "container_id": "tradingview_btc"});
        </script>
    </div>
    <div class="grid" id="table-grid"></div>
    <script src="app.js"></script>
    <script>
        const grid = document.getElementById('table-grid');
        for(let i=1; i<=25; i++) { grid.innerHTML += `<div id="card-${i}" class="card">T-${i}<div id="bet-${i}"></div></div>`; }
        stateRef.on('value', snap => {
            const d = snap.val() || {};
            document.getElementById('jackpot').innerText = `$${(d.jackpot || 0)}`;
            document.getElementById('timer').innerText = d.timer || '00';
            document.getElementById('status-msg').innerText = d.status || "READY";
            if (d.winnerFound) {
                document.getElementById('winner-screen').style.display = 'flex';
                document.getElementById('winner-name').innerText = `TABLE ${d.winnerId}`;
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            }
        });
        tablesRef.on('value', snap => {
            const ts = snap.val() || {};
            for(let i=1; i<=25; i++) {
                const t = ts[i] || {status: 'active'};
                document.getElementById(`card-${i}`).className = `card ${t.status} ${t.currentBet ? 'betting' : ''}`;
                document.getElementById(`bet-${i}`).innerText = t.currentBet ? t.currentBet.toUpperCase() : '';
            }
        });
        setInterval(async () => {
            const r = await fetch(BTSE_API); const j = await r.json();
            document.getElementById('btc-price').innerText = `$${parseFloat(j[0].last).toFixed(2)}`;
        }, 2000);
    </script>
</body>
</html>
