<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Portal</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body class="mobile-body">
    <div class="mobile-header">
        <h2 id="table-label">T--</h2>
        <div class="price-box">
            <div id="live-btc" style="color:var(--gold); font-size: 20px;">$---</div>
            <div id="target-btc" style="font-size: 12px; color: gray;">Target: $---</div>
        </div>
    </div>

    <div id="bet-ui">
        <div id="trend-indicator" style="font-size: 24px; margin: 20px 0; font-weight: bold;">--</div>
        <div class="bet-buttons">
            <button id="btn-up" class="bet-btn up" onclick="placeBet('up')">UP</button>
            <button id="btn-down" class="bet-btn down" onclick="placeBet('down')">DOWN</button>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        const tid = new URLSearchParams(window.location.search).get('id');
        let targetPrice = 0;

        initPriceTicker((price) => {
            document.getElementById('live-btc').innerText = `$${price.toFixed(2)}`;
            if (targetPrice > 0) {
                const diff = price - targetPrice;
                const trend = document.getElementById('trend-indicator');
                trend.innerText = diff >= 0 ? "▲ ABOVE" : "▼ BELOW";
                trend.style.color = diff >= 0 ? "var(--green)" : "var(--red)";
            }
        });

        stateRef.on('value', snap => {
            const s = snap.val();
            targetPrice = s.startPrice || 0;
            document.getElementById('target-btc').innerText = `Target: $${targetPrice.toFixed(2)}`;
            
            const btns = document.querySelectorAll('.bet-btn');
            btns.forEach(b => b.disabled = (s.status !== "BETS OPEN"));
        });

        tablesRef.child(tid).on('value', snap => {
            const t = snap.val();
            if(!t) return;
            document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('selected'));
            if(t.currentBet) document.getElementById(`btn-${t.currentBet}`).classList.add('selected');
            if(t.status === 'out') document.body.innerHTML = "<h1>ELIMINATED</h1>";
        });

        function placeBet(dir) { tablesRef.child(tid).update({ currentBet: dir }); }
    </script>
</body>
</html>
