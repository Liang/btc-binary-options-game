<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Portal</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body class="mobile-body">
    <div class="mobile-header">
        <h2 id="table-label">TABLE --</h2>
        <div id="live-btc" style="color:var(--gold); font-family:monospace;">$---</div>
    </div>

    <div id="bet-ui">
        <div id="selection-display" style="padding:10px; margin-bottom:15px; border-radius:8px; background:#181a20; font-size:14px;">
            YOUR SELECTION: <span id="current-pick" style="font-weight:bold; color:var(--gold)">NONE</span>
        </div>

        <div class="bet-buttons">
            <button id="btn-up" class="bet-btn up" onclick="placeBet('up')">UP</button>
            <button id="btn-down" class="bet-btn down" onclick="placeBet('down')">DOWN</button>
        </div>
        <p id="status-text" style="font-weight:bold; color:var(--gold)">--</p>
    </div>

    <script src="app.js"></script>
    <script>
        const tid = new URLSearchParams(window.location.search).get('id');
        document.getElementById('table-label').innerText = `TABLE ${tid}`;

        initPriceTicker((price) => {
            document.getElementById('live-btc').innerText = `$${price.toFixed(2)}`;
        });

        stateRef.on('value', snap => {
            const s = snap.val();
            const btns = document.querySelectorAll('.bet-btn');
            const canBet = (s.status === "BETS OPEN");
            btns.forEach(b => b.disabled = !canBet);
            document.getElementById('status-text').innerText = s.status;
        });

        tablesRef.child(tid).on('value', snap => {
            const t = snap.val();
            if(!t) return;
            
            // Visual Update for chosen direction
            const pickDisplay = document.getElementById('current-pick');
            document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('selected'));
            
            if(t.currentBet) {
                document.getElementById(`btn-${t.currentBet}`).classList.add('selected');
                pickDisplay.innerText = t.currentBet.toUpperCase();
                pickDisplay.style.color = t.currentBet === 'up' ? 'var(--green)' : 'var(--red)';
            } else {
                pickDisplay.innerText = "NONE";
                pickDisplay.style.color = "var(--gold)";
            }

            if(t.status === 'out') {
                document.getElementById('bet-ui').innerHTML = "<h1 style='color:red; margin-top:50px;'>ELIMINATED</h1>";
            }
        });

        function placeBet(dir) { 
            tablesRef.child(tid).update({ currentBet: dir }); 
        }
    </script>
</body>
</html>
