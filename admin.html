<!DOCTYPE html>
<html>
<head>
    <title>Tournament Admin</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body style="padding: 20px;">
    <div class="admin-card">
        <h2>Tournament Master Control</h2>
        
        <div style="margin-bottom: 20px; padding: 10px; border: 1px solid #444;">
            <label>Total Participating Tables:</label>
            <input type="number" id="count-input" value="25" style="width: 50px;">
            <button onclick="setupTournament()" style="width: auto; padding: 5px 10px;">Setup Game</button>
        </div>

        <button class="btn-gold" onclick="startBetting()">1. OPEN 60s BETTING WINDOW</button>
        
        <button class="btn-gold" style="background:#6f42c1; color: white;" onclick="fastForwardRound()">
            ðŸ§ª FAST-FORWARD ROUND (Simulate & Resolve)
        </button>

        <button class="btn-gold" style="background:#28a745" onclick="resolveTournamentRound()">
            2. MANUAL RESOLVE (Real Result)
        </button>
        
        <button class="btn-red" onclick="resetTournament()">HARD RESET TO START</button>
    </div>

    <script src="app.js"></script>
    <script>
        // Use the common Setup from before
        function setupTournament() {
            const count = parseInt(document.getElementById('count-input').value);
            stateRef.update({ tableCount: count, jackpot: 0, status: "READY TO START", winnerFound: false });
            tablesRef.set({});
            for(let i=1; i<=count; i++) {
                tablesRef.child(i).set({ status: 'active', currentBet: null });
            }
        }

        async function startBetting() {
            const price = await fetchBTCPrice();
            stateRef.update({ status: "BETTING OPEN", timer: 60, startPrice: price, winnerFound: false });
            // ... (Timer logic remains same)
        }

        // NEW SIMULATION LOGIC: Processes everything instantly
        async function fastForwardRound() {
            const currentPrice = await fetchBTCPrice();
            const simulatedResult = Math.random() > 0.5 ? 'up' : 'down';
            
            stateRef.once('value', snap => {
                const s = snap.val();
                tablesRef.once('value', tSnap => {
                    const ts = tSnap.val() || {};
                    let survivors = [];
                    let newlyEliminated = 0;

                    Object.keys(ts).forEach(id => {
                        if(ts[id].status === 'active') {
                            // Assign a random bet (50/50 chance to survive)
                            const tableBet = Math.random() > 0.5 ? 'up' : 'down';
                            
                            if(tableBet !== simulatedResult) {
                                tablesRef.child(id).update({ status: 'out', currentBet: null });
                                newlyEliminated++;
                            } else {
                                tablesRef.child(id).update({ currentBet: null });
                                survivors.push(id);
                            }
                        }
                    });

                    // Update Jackpot and Status
                    let newJackpot = (s.jackpot || 0) + (newlyEliminated * 1200);
                    let updateData = { 
                        status: `SIMULATED RESULT: ${simulatedResult.toUpperCase()}`, 
                        jackpot: newJackpot 
                    };

                    if (survivors.length === 1) {
                        updateData.winnerFound = true;
                        updateData.winnerId = survivors[0];
                    }

                    stateRef.update(updateData);
                });
            });
        }

        async function resolveTournamentRound() {
            // ... (Keep your existing Real Price resolution logic here)
        }

        function resetTournament() {
            if(confirm("Wipe all data?")) setupTournament();
        }
    </script>
</body>
</html>
